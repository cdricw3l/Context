
# Context App

             +--------------------------------------------------+
             |                                                  |
             |                 Instance Utilisateur A           |
             |                                                  |
             | +----------------------------------------------+ |
             | | Application React                            | |
             | |                                              | |
             | | +----------------------------------------+  | |
             | | |  ResponseProvider                      |  | |
             | | |  (Context)                             |  | |
             | | |                                        |  | |
             | | |  +---------------------------------+  |  | |
             | | |  | NavBar                          |  |  | |
             | | |  |  - InputForm                    |  |  | |
             | | |  +---------------------------------+  |  | |
             | | |  | RightPanel                      |  |  | |
             | | |  |  - Messages                     |  |  | |
             | | |  |  - Files                        |  |  | |
             | | |  |  - TreeBlock                    |  |  | |
             | | |  +---------------------------------+  |  | |
             | | +----------------------------------------+ | |
             | +----------------------------------------------+ |
             |   |                                              |
             |   |                                              |
             |   v                                              |
             |   +-----------------+                            |
             |   |  API GitHub     |                            |
             |   +-----------------+                            |
             |   | - Fetch Repo    |                            |
             |   | - Fetch Branch  |                            |
             |   | - Fetch Tree    |                            |
             |   +-----------------+                            |
             |                                                  |
             +--------------------------------------------------+

             +--------------------------------------------------+
             |                                                  |
             |                 Instance Utilisateur B           |
             |                                                  |
             | +----------------------------------------------+ |
             | | Application React                            | |
             | |                                              | |
             | | +----------------------------------------+  | |
             | | |  ResponseProvider                      |  | |
             | | |  (Context)                             |  | |
             | | |                                        |  | |
             | | |  +---------------------------------+  |  | |
             | | |  | NavBar                          |  |  | |
             | | |  |  - InputForm                    |  |  | |
             | | |  +---------------------------------+  |  | |
             | | |  | RightPanel                      |  |  | |
             | | |  |  - Messages                     |  |  | |
             | | |  |  - Files                        |  |  | |
             | | |  |  - TreeBlock                    |  |  | |
             | | |  +---------------------------------+  |  | |
             | | +----------------------------------------+ | |
             | +----------------------------------------------+ |
             |   |                                              |
             |   |                                              |
             |   v                                              |
             |   +-----------------+                            |
             |   |  API GitHub     |                            |
             |   +-----------------+                            |
             |   | - Fetch Repo    |                            |
             |   | - Fetch Branch  |                            |
             |   | - Fetch Tree    |                            |
             |   +-----------------+                            |
             |                                                  |
             +--------------------------------------------------+

# NEXT AUTH

          +-------------------------+
          |        Utilisateur      |
          +-----------+-------------+
                      |
                      v
          +-----------+-------------+
          |   Formulaire (Next.js)  |
          +-----------+-------------+
                      |
                      v
          +-------------------------+
          |      API Routes         |
          |  (pages/api/auth/[...]) |
          +-----------+-------------+
                      |
                      v
          +-------------------------+
          |     NextAuth.js         |
          | (authentification log.) |
          +-----------+-------------+
                      |
                      v
          +-------------------------+
          |      Base de donn√©es    |
          +-------------------------+


+--------------------------------------------------+
|                                                  |
|                 Instance Utilisateur A           |
|                                                  |
| +----------------------------------------------+ |
| | Application React                            | |
| |                                              | |
| | +----------------------------------------+  | |
| | |  ResponseProvider                      |  | |
| | |  (Context)                             |  | |
| | |                                        |  | |
| | |  +---------------------------------+  |  | |
| | |  | NavBar                          |  |  | |
| | |  |  - InputForm                    |  |  | |
| | |  +---------------------------------+  |  | |
| | |  | RightPanel                      |  |  | |
| | |  |  - Messages                     |  |  | |
| | |  |  - Files                        |  |  | |
| | |  |  - TreeBlock                    |  |  | |
| | |  +---------------------------------+  |  | |
| | +----------------------------------------+ | |
| |                                              | |
| | +----------------------------------------+  | |
| | |  SessionProvider                      |  | |
| | |  (Context)                            |  | |
| | |                                        |  | |
| | |  +---------------------------------+  |  | |
| | |  | SignIn                          |  |  | |
| | |  +---------------------------------+  |  | |
| | |  | AuthenticatedLayout             |  |  | |
| | |  +---------------------------------+  |  | |
| | +----------------------------------------+ | |
| +----------------------------------------------+ |
|   |                                              |
|   |                                              |
|   v                                              |
|   +-----------------+                            |
|   |  API Auth      |                            |
|   +-----------------+                            |
|   | - Sign In      |                            |
|   | - Register     |                            |
|   | - GetSession   |                            |
|   +-----------------+                            |
|                                                  |
+--------------------------------------------------+

+--------------------------------------------------+
|                                                  |
|                 Instance Utilisateur B           |
|                                                  |
| +----------------------------------------------+ |
| | Application React                            | |
| |                                              | |
| | +----------------------------------------+  | |
| | |  ResponseProvider                      |  | |
| | |  (Context)                             |  | |
| | |                                        |  | |
| | |  +---------------------------------+  |  | |
| | |  | NavBar                          |  |  | |
| | |  |  - InputForm                    |  |  | |
| | |  +---------------------------------+  |  | |
| | |  | RightPanel                      |  |  | |
| | |  |  - Messages                     |  |  | |
| | |  |  - Files                        |  |  | |
| | |  |  - TreeBlock                    |  |  | |
| | |  +---------------------------------+  |  | |
| | +----------------------------------------+ | |
| |                                              | |
| | +----------------------------------------+  | |
| | |  SessionProvider                      |  | |
| | |  (Context)                            |  | |
| | |                                        |  | |
| | |  +---------------------------------+  |  | |
| | |  | SignIn                          |  |  | |
| | |  +---------------------------------+  |  | |
| | |  | AuthenticatedLayout             |  |  | |
| | |  +---------------------------------+  |  | |
| | +----------------------------------------+ | |
| +----------------------------------------------+ |
|   |                                              |
|   |                                              |
|   v                                              |
|   +-----------------+                            |
|   |  API Auth      |                            |
|   +-----------------+                            |
|   | - Sign In      |                            |
|   | - Register     |                            |
|   | - GetSession   |                            |
|   +-----------------+                            |
|                                                  |
+--------------------------------------------------+


+------------------------------------------------------------+
|                       Authentification                      |
|                                                            |
|   +------------------------------------------------------+ |
|   |                 pages/api/auth/[...nextauth].ts       | |
|   |  - Configure NextAuth                                 | |
|   |  - Define Providers (Credentials)                     | |
|   |  - Handle JWT sessions and callbacks                  | |
|   +------------------------------------------------------+ |
|                                                            |
|   +------------------------------------------------------+ |
|   |                 pages/api/auth/register.ts            | |
|   |  - Handle user registration                           | |
|   |  - Hash password before saving                        | |
|   +------------------------------------------------------+ |
|                                                            |
+------------------------------------------------------------+

+------------------------------------------------------------+
|                  pages/api/auth/[...nextauth].ts            |
|  - Handle Sign In                                           |
|  - Validate credentials using `zod`                         |
|  - Retrieve user from DB using `utils/db.ts`                |
|  - Verify password using `utils/password.ts`                |
|  - Return user if valid, null if invalid                    |
+------------------------------------------------------------+

+------------------------------------------------------------+
|                      Session Management                     |
|  - NextAuth manages sessions using JWT                      |
|  - `useSession` hook in components to get session data      |
|  - JWT stored in cookies with HttpOnly attribute            |
+------------------------------------------------------------+

+------------------------------------------------------------+
|                  Composants d'authentification               |
|                                                            |
|   +------------------------------------------------------+ |
|   |                     SignIn.tsx                        | |
|   |  - Form to handle user sign-in                        | |
|   |  - Call `signIn` from `next-auth/react`               | |
|   +------------------------------------------------------+ |
|                                                            |
|   +------------------------------------------------------+ |
|   |                     SignUp.tsx                        | |
|   |  - Form to handle user registration                   | |
|   |  - Call API to register user                          | |
|   +------------------------------------------------------+ |
|                                                            |
|   +------------------------------------------------------+ |
|   |                   AuthenticatedLayout.tsx             | |
|   |  - Wrap children components                           | |
|   |  - Show loading, SignIn, or children based on session | |
|   +------------------------------------------------------+ |
|                                                            |
+------------------------------------------------------------+

+------------------------------------------------------------+
|                     Context Management                      |
|   +------------------------------------------------------+ |
|   |                  ResponseContext.tsx                  | |
|   |  - Manage global state for the application            | |
|   +------------------------------------------------------+ |
|                                                            |
|   +------------------------------------------------------+ |
|   |                      Layout.tsx                       | |
|   |  - Wrap application with providers                    | |
|   +------------------------------------------------------+ |
+------------------------------------------------------------+

+------------------------------------------------------------+
|                     Prisma et PostgreSQL                    |
|   +------------------------------------------------------+ |
|   |                      prisma.ts                        | |
|   |  - Initialize Prisma Client                           | |
|   +------------------------------------------------------+ |
|                                                            |
|   +------------------------------------------------------+ |
|   |                      schema.prisma                    | |
|   |  - Define User and Session models                     | |
|   +------------------------------------------------------+ |
|                                                            |
|   +------------------------------------------------------+ |
|   |                      db.ts                            | |
|   |  - Define functions to interact with DB               | |
|   |  - Create user, get user by email                     | |
|   +------------------------------------------------------+ |
+------------------------------------------------------------+
